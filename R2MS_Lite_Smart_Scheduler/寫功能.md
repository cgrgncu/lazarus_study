# 寫功能
+ 作者: HsiupoYeh  
+ 更新日期: 2025-09-19

### 設計規定
+ 多源放電:
  + M64
+ 單源放電:
  + S64N
  + S64HS
  + S64VHS  

### 開發紀錄(寫功能部分)
+ 1.INI檔案讀寫
  + 1.1 去implementation區塊追加宣告全域變數
```
implementation
//--------------------------------------------------------------------------
//uses add by HsiupoYeh
uses
  IniFiles;
//--------------------------------------------------------------------------
//--------------------------------------------------------------------------
//宣告全域變數 add by HsiupoYeh
var
  version_str: AnsiString;
  Current_Folder_Path: AnsiString;
//--------------------------------------------------------------------------

{$R *.lfm}   
```
  + 選Form，去編輯FormCreate
```
procedure TForm1.FormCreate(Sender: TObject);
var
  temp_str: AnsiString;
  temp_TDateTime: TDateTime;
  need_write_ini_file: boolean;
  my_TMemIniFile: TMemIniFile;
begin
  //--------------------------------------------------------------------------
  // 在這裡對全域變數進行初始化
  version_str := 'v20250920a';
  Current_Folder_Path := ExtractFilePath(Application.ExeName);
  //--------------------------------------------------------------------------
  //--------------------------------------------------------------------------
  // 表單標題追加版本
  Form1.Caption := Form1.Caption + ' ' + version_str;
  //--------------------------------------------------------------------------
  //--------------------------------------------------------------------------
  // 設定我指定的路徑作為R2MS_Lite_WorkSpace資料夾，路徑命名格式依照ERT_ver2_9_9_Client的白痴路徑格式。
  // 例如:「/C/Users/USER/Desktop/R2MS_Lite_Smart_Scheduler_v20250920a/R2MS_Lite_WorkSpace/ERT_ver2_9_9_Client_Data」
  ERT_ver2_9_9_Client_SavePath_Edit.Text := '/' + Current_Folder_Path + 'R2MS_Lite_WorkSpace\ERT_ver2_9_9_Client_Data';
  ERT_ver2_9_9_Client_SavePath_Edit.Text := StringReplace(ERT_ver2_9_9_Client_SavePath_Edit.Text, ':', '', []);
  ERT_ver2_9_9_Client_SavePath_Edit.Text := StringReplace(ERT_ver2_9_9_Client_SavePath_Edit.Text, '\', '/', [rfReplaceAll]);
  //--------------------------------------------------------------------------
  //--------------------------------------------------------------------------
  // 讀取INI參數檔案
  // 記得在 uses 區塊中加入 IniFiles
  my_TMemIniFile := TMemIniFile.Create(ChangeFileExt(ExtractFileName(Application.ExeName), '.ini'));

  if FileExists(ChangeFileExt(ExtractFileName(Application.ExeName), '.ini')) then
  begin
    //--
    // 目標INI檔案存在，不需要寫入新的INI。
    need_write_ini_file := False;
    //--
    // INI: [Version] -> Version
    temp_str := my_TMemIniFile.ReadString('Version', 'Version', '');
    //RunningLog_Memo.Lines.Add('INI: [Version] -> Version = ' + temp_str);
    if temp_str = '' then
    begin
      temp_str := '嚴重錯誤:' + #13#10 + '檔案「' +
        ChangeFileExt(ExtractFileName(Application.ExeName), '.ini') +
        '」內容異常!程式將立即終止!' + #13#10 +
        '請檢查[Version] -> Version 設定。' + #13#10 +
        '或刪除該檔案後重新運行程式，取得預設INI檔案。';
      Application.MessageBox(PChar(temp_str), '錯誤', 16);
      Application.Terminate;
    end;
    //--
    // INI: [Version] -> Author
    temp_str := my_TMemIniFile.ReadString('Version', 'Author', '');
    //RunningLog_Memo.Lines.Add('INI: [Version] -> Author = ' + temp_str);
    if temp_str = '' then
    begin
      temp_str := '嚴重錯誤:' + #13#10 + '檔案「' +
        ChangeFileExt(ExtractFileName(Application.ExeName), '.ini') +
        '」內容異常!程式將立即終止!' + #13#10 +
        '請檢查[Version] -> Author 設定。' + #13#10 +
        '或刪除該檔案後重新運行程式，取得預設INI檔案。';
      Application.MessageBox(PChar(temp_str), '錯誤', 16);
      Application.Terminate;
    end;
    //--
    // INI: [ERT_ver2_9_9_Client] -> ERT_Profile_Name
    temp_str := my_TMemIniFile.ReadString('ERT_ver2_9_9_Client', 'ERT_Profile_Name', '');
    //RunningLog_Memo.Lines.Add('INI: [ERT_ver2_9_9_Client] -> ERT_Profile_Name = ' + temp_str);
    if (Length(temp_str) >= 3) and (temp_str[1] = '"') and (temp_str[Length(temp_str)] = '"') then
    begin
      ERT_Profile_Name_Edit.Text := Copy(temp_str, 2, Length(temp_str) - 2);
    end
    else
    begin
      temp_str := '嚴重錯誤:' + #13#10 + '檔案「' +
        ChangeFileExt(ExtractFileName(Application.ExeName), '.ini') +
        '」內容異常!程式將立即終止!' + #13#10 +
        '請檢查[ERT_ver2_9_9_Client] -> ERT_Profile_Name 設定。' + #13#10 +
        '或刪除該檔案後重新運行程式，取得預設INI檔案。';
      Application.MessageBox(PChar(temp_str), '錯誤', 16);
      Application.Terminate;
    end;
    //--
  end
  else
  begin
    //--
    // 目標INI檔案不存在，需要寫入新的INI。
    need_write_ini_file := True;
    //--
  end;
  //--------------------------------------------------------------------------
  //--------------------------------------------------------------------------
  // 寫入參數檔案
  if need_write_ini_file then
  begin
    RunningLog_Memo.Lines.Add('「' + ChangeFileExt(ExtractFileName(Application.ExeName), '.ini') + '」不存在!');
    my_TMemIniFile.WriteString('Version', 'Version', '"' + version_str + '"');
    my_TMemIniFile.WriteString('Version', 'Author', '"HsiupoYeh"');
    my_TMemIniFile.WriteString('ERT_ver2_9_9_Client', 'ERT_Profile_Name', '"XP1"');
    my_TMemIniFile.WriteString('ERT_ver2_9_9_Client', 'ERT_Project_Name', '"[20240409A]Taiwan-Taipei-XiaoYouKengScenicPlatform(XYKP)"');
    my_TMemIniFile.WriteString('ERT_ver2_9_9_Client', 'DMM_SN', '"MY60077634"');
    my_TMemIniFile.WriteString('ERT_ver2_9_9_Client', 'DMM_ComPort', '"USB0::0x2A8D::0x0101::MY60077634::INSTR"');
    my_TMemIniFile.WriteString('ERT_ver2_9_9_Client', 'SwitchArray_SN', '"S000"');
    my_TMemIniFile.WriteString('ERT_ver2_9_9_Client', 'SwitchArray_ComPort', '"COM3"');
    my_TMemIniFile.WriteString('ERT_ver2_9_9_Client', 'PSU_SN', '"508I23118"');
    my_TMemIniFile.WriteString('ERT_ver2_9_9_Client', 'PSU_ComPort', '"COM4"');
    my_TMemIniFile.WriteString('Schedule', 'Every_Day_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_001', '"00:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_001_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_001_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_002', '"01:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_002_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_002_CurrentMode', '"MultipleSource"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_003', '"02:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_003_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_003_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_004', '"03:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_004_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_004_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_005', '"04:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_005_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_005_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_006', '"05:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_006_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_006_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_007', '"06:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_007_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_007_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_008', '"07:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_008_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_008_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_009', '"08:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_009_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_009_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_010', '"09:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_010_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_010_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_011', '"10:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_011_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_011_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_012', '"11:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_012_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_012_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_013', '"12:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_013_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_013_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_014', '"13:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_014_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_014_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_015', '"14:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_015_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_015_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_016', '"15:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_016_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_016_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_017', '"16:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_017_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_017_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_018', '"17:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_018_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_018_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_019', '"18:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_019_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_019_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_020', '"19:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_020_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_020_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_021', '"20:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_021_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_021_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_022', '"21:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_022_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_022_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_023', '"22:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_023_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_023_CurrentMode', '"SystemTest"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_024', '"23:01"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_024_Enable', '"True"');
    my_TMemIniFile.WriteString('Schedule', 'JOB_024_CurrentMode', '"SystemTest"');
    my_TMemIniFile.UpdateFile();
    temp_str := '提示:' + #13#10 + '檔案「' +
      ChangeFileExt(ExtractFileName(Application.ExeName), '.ini') +
      '」不存在!程式將立即終止!' + #13#10 +
      '本程式已自動重新產生預設INI檔案。' + #13#10 +
      '請按下確定後手動重新運行本程式。';
    Application.MessageBox(PChar(temp_str), '提示', 64);
    Application.Terminate;
  end;
  //--------------------------------------------------------------------------
  my_TMemIniFile.Free;
  //--------------------------------------------------------------------------
end;
```

2. 不給改勾選
```pascal
// 這個事件處理程序會被 TListView 元件的 OnItemCheck 事件呼叫
procedure TForm1.ListView1ItemCheck(Sender: TObject; Item: TListItem);
begin
  // 假設你預設的勾選狀態儲存在某個地方，
  // 這裡以 Item.Data 屬性來儲存預設狀態為例
  // Item.Data 是一個指標，你可以用它來儲存任何你想要的資訊
  if Assigned(Item.Data) then
  begin
    // 如果 Item.Data 儲存的是 True，表示它應該被勾選
    if PBoolean(Item.Data)^ then
    begin
      Item.Checked := True; // 強制將勾選狀態設為 True
    end
    else
    begin
      Item.Checked := False; // 強制將勾選狀態設為 False
    end;
  end;
end;
```
3. 
